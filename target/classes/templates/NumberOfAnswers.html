<!DOCTYPE html>
<html>
<head>
    <title>Question Details</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div style="width: 100%;height: 500px;display: flex;justify-self: center">
    <div style="width: 100%; height: 500px; display: flex; justify-content: space-between;">
        <canvas id="myPieChart" style="width: 40%;"></canvas>

    </div>
    <div style="width: 100%; height: 500px;">
        <canvas id="myBarChart" style="width:40%;"></canvas>
        <div style="width: 40%;">
            <p>Answer Count Maximum: <span id="maxValue"></span></p>
            <p>Answer Count Average: <span id="avgValue"></span></p>
        </div>
    </div>
</div>
<script>
    const pieChartUrl = '/question-without-answer';
    const barChartUrl = '/answer-count-distribution';
    const maxUrl = '/answer-count-maximum';
    const avgUrl = '/answer-count-average';

    // 获取数据
    Promise.all([
        fetch(pieChartUrl),
        fetch(barChartUrl),
        fetch(maxUrl),
        fetch(avgUrl),
    ]).then(([pieChartResponse, barChartResponse, maxResponse, avgResponse]) => {
        return Promise.all([
            pieChartResponse.json(),
            barChartResponse.json(),
            maxResponse.json(),
            avgResponse.json(),
        ]);
    }).then(([pieChartData, barChartData, maxData, avgData]) => {
        // 饼图
        var pieCtx = document.getElementById('myPieChart').getContext('2d');
        var pieChart = new Chart(pieCtx, {
            type: 'pie',
            data: {
                labels: ['Questions Without Answer', 'Questions With Answer'],
                datasets: [{
                    data: [pieChartData, 100 - pieChartData],
                    backgroundColor: [
                        'rgba(255, 99, 132, 0.5)',
                        'rgba(54, 162, 235, 0.5)',
                    ],
                }],
            },
            options: {
                tooltips: {
                    callbacks: {
                        label: function (tooltipItem, data) {
                            var dataset = data.datasets[tooltipItem.datasetIndex];
                            var label = dataset.labels[tooltipItem.index] || '';
                            var value = dataset.data[tooltipItem.index];
                            return label + ': ' + value + '%';
                        }
                    }
                },
                hover: {
                    onHover: function (e, items) {
                        e.target.style.cursor = items[0] ? 'pointer' : 'default';
                    }
                },
            }
        });

        // 柱状图
        var labels = [], values = [];
        Object.keys(barChartData).forEach(key => {
            labels.push(key.toString());
            values.push(barChartData[key]);
        });

        var barCtx = document.getElementById('myBarChart').getContext('2d');
        var barChart = new Chart(barCtx, {
            type: 'bar',
            data: {
                labels: labels,
                datasets: [{
                    label: 'Answer Count Distribution',
                    data: values,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                }],
            },
            options: {
                scales: {
                    yAxes: [{
                        ticks: {
                            beginAtZero: true,
                        }
                    }]
                }
            }
        });

        // 最大值和平均值
        var maxSpan = document.getElementById('maxValue');
        maxSpan.innerHTML = maxData;

        var avgSpan = document.getElementById('avgValue');
        avgSpan.innerHTML = avgData.toFixed(2);
    }).catch(error => {
        console.error(error);
    });
</script>
</body>
</html>