<!DOCTYPE html>
<html>
<head>
    <title>Accepted Answers</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        h1 {
            text-align: center;
        }

        .chart-container {
            display: flex;
            justify-content: space-around;
            margin: 20px 0;
        }

        .chart {
            width: 300px;
            height: 300px;
        }

        .histogram {
            width: 500px;
            height: 300px;
            border: 1px solid #ccc;
        }
    </style>
</head>
<body style="text-align: center">
<h1>Accepted Answers</h1>

<!-- 图表容器 -->
<div class="chart-container">
    <div class="chart">
        <canvas id="pieHasAcceptedAnswer" class="chart"></canvas>
    </div>
    <div class="chart">
        <canvas id="pieUpvoteMoreThanAccepted" class="chart"></canvas>
    </div>
    <div class="histogram">
        <canvas id="histogram" class="histogram"></canvas>
    </div>
</div>

<!-- JS 代码 -->
<script>
    // 使用 fetch API 发送 GET 请求，获取数据
    fetch('/has-accepted-answer')
        .then(response => response.json())
        .then(data => {
            const percent = (data).toFixed(2);

            // 生成问题的 accepted answer 比例的饼图
            const pieHasAcceptedAnswer = new Chart(document.getElementById('pieHasAcceptedAnswer'), {
                type: 'pie',
                data: {
                    labels: ['Have Accepted answer', 'Not Have Accepted Answer'],
                    datasets: [{
                        labels: ['Percentage - Have', 'Percentage - Not Have'],
                        data: [percent, 100 - percent],
                        backgroundColor: ['#36A2EB', '#FF6384']
                    }]
                },
                options: {
                    legend: {
                        position: 'bottom'
                    }
                }
            });

            // 使用 fetch API 发送 GET 请求，获取数据
            fetch('/more-upvotes-than-accpeted')
                .then(response => response.json())
                .then(data => {
                    const percent = (data).toFixed(2);

                    // 生成 non-accepted answer 的 upvote 数高于 accepted answer 的问题的百分比的饼图
                    const pieUpvoteMoreThanAccepted = new Chart(document.getElementById('pieUpvoteMoreThanAccepted'), {
                        type: 'pie',
                        data: {
                            labels: ['Singular Question', 'Non-singular Question'],
                            datasets: [{
                                labels: ["Percentage - Singular", "Percentage - NonSingular"],
                                data: [percent, 100 - percent],
                                backgroundColor: ['#FFCE56', '#36A2EB']
                            }]
                        },
                        options: {
                            legend: {
                                position: 'bottom'
                            }
                        }
                    });

                    // 使用 fetch API 发送 GET 请求，获取数据
                    fetch('/from-post-to-accept')
                        .then(response => response.json())
                        .then(data => {
                            // 将时间间隔转换为分钟，并进行分类统计
                            const intervals = data.map(i => Math.round(i / (60 * 1000)));
                            const histogramData = intervals.reduce((acc, cur) => {
                                if (cur <= 5) {
                                    acc[0]++;
                                } else if (cur <= 30) {
                                    acc[1]++;
                                } else if (cur <= 60) {
                                    acc[2]++;
                                } else if (cur <= 1440) {
                                    acc[3]++;
                                } else {
                                    acc[4]++;
                                }
                                return acc;
                            }, [0, 0, 0, 0, 0]);

                            // 计算统计结果的最大值，用于设置数轴的范围
                            const maxCount = Math.max(...histogramData);

                            // 生成时间间隔分布的直方图
                            const histogram = new Chart(document.getElementById('histogram'), {
                                type: 'bar',
                                data: {
                                    labels: ['< 5 minutes', '5 - 30 minutes', '30 - 60 minutes', '1 - 24 hours', '> 24 hours'],
                                    datasets: [{
                                        label: 'Time interval distribution',
                                        data: histogramData,
                                        backgroundColor: '#36A2EB'
                                    }]
                                },
                                options: {
                                    scales: {
                                        yAxes: [{
                                            ticks: {
                                                beginAtZero: true,
                                                max: maxCount + 1
                                            }
                                        }]
                                    }
                                }
                            });
                        });
                });
        });
</script>
</body>
</html>